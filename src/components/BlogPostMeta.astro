---
import type { ProcessedPost, PostMeta, BreadcrumbItem } from '../utils/blogUtils';
import Breadcrumb from './Breadcrumb.astro';
import Icon from './Icon.astro';
import { 
  generatePostMeta, 
  generateBreadcrumbs
} from '../utils/blogUtils';

export interface Props {
  post: ProcessedPost;
  includeBreadcrumbs?: boolean;
}

const { post, includeBreadcrumbs = true } = Astro.props;

// Generar metadatos para mostrar en la UI
const postMeta: PostMeta = generatePostMeta(post);
const breadcrumbs: BreadcrumbItem[] = includeBreadcrumbs ? generateBreadcrumbs(post) : [];
---

<!-- Breadcrumbs visuales -->
{includeBreadcrumbs && breadcrumbs.length > 0 && (
  <Breadcrumb 
    items={breadcrumbs} 
    align="left" 
    variant="minimal" 
    includeSchema={true}
  />
)}

<!-- Metadatos del post -->
<div class="flex flex-wrap items-center gap-6 mb-8">
  <!-- Fecha de publicación -->
  <div class="flex items-center gap-2">
    <Icon name="calendar" class="w-4 h-4 text-ink-subtle" />
    <time datetime={post.data.pubDate} class="text-[0.875rem] text-ink-subtle leading-[1.5]">
      {postMeta.publishDate}
    </time>
  </div>
  
  <!-- Tiempo de lectura -->
  <div class="flex items-center gap-2">
    <Icon name="clock" class="w-4 h-4 text-ink-subtle" />
    <span class="text-[0.875rem] text-ink-subtle leading-[1.5]">
      {postMeta.readingTime}
    </span>
  </div>
  
  <!-- Autor -->
  <div class="flex items-center gap-2">
    <Icon name="user" class="w-4 h-4 text-ink-subtle" />
    <span class="text-[0.875rem] text-ink-subtle leading-[1.5]">
      {postMeta.author}
    </span>
  </div>
</div>

<!-- Categoría y Tags -->
{(post.data.category || (post.data.tags && post.data.tags.length > 0)) && (
  <div class="flex flex-wrap items-center gap-2 mb-8">
    <!-- Categoría - Badge info según Design.json -->
    {post.data.category && (
      <span class="badge badge-info">
        {post.processedData.categoryName || post.data.category}
      </span>
    )}
    
    <!-- Tags - Badge teal según Design.json -->
    {post.data.tags && post.data.tags.length > 0 && (
      post.data.tags.map((tag: string) => (
        <span class="badge badge-teal">
          {tag}
        </span>
      ))
    )}
  </div>
)}

<style>
  /* Badges según Design.json */
  .badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 10px;
    border-radius: var(--pv-radius-pill);
    font-size: 0.875rem;
    font-weight: 400;
    line-height: 1.5;
  }

  .badge-info {
    background-color: var(--pv-primary-soft);
    color: var(--pv-primary-base);
  }

  .badge-teal {
    background-color: var(--pv-secondary-soft);
    color: var(--pv-secondary-base);
  }
</style>
